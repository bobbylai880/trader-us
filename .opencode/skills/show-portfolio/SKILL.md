---
name: show-portfolio
description: 展示当前持仓状态、盈亏和历史操作。触发词：持仓、仓位、portfolio、我的股票、盈亏、账户
license: MIT
compatibility: opencode
metadata:
  category: trading
  workflow: portfolio-management
---

# Show Portfolio Skill

展示当前持仓状态、实时盈亏和历史操作记录。

## 触发条件

- 用户询问持仓情况
- 用户查看账户状态
- 用户请求盈亏报告

## 执行步骤

### 1. 获取持仓数据

```
portfolio = get_portfolio()
```

### 2. 获取实时价格

对每个持仓获取当前价格：

```
for position in portfolio.positions:
    current_price = get_price(position.symbol)
```

### 3. 计算盈亏

```python
for position in positions:
    市值 = 股数 × 当前价格
    成本 = 股数 × 平均成本
    盈亏金额 = 市值 - 成本
    盈亏百分比 = (当前价格 / 平均成本 - 1) × 100
```

### 4. 获取历史操作（可选）

```
history = get_operations_history(days=30)
```

### 5. 输出格式

```markdown
## 📊 持仓概览

**更新时间**: YYYY-MM-DD HH:MM
**数据来源**: 实时价格

### 账户摘要

| 项目 | 金额 |
|------|------|
| 总权益 | $XXX,XXX |
| 持仓市值 | $XXX,XXX |
| 现金 | $XX,XXX |
| 总仓位 | XX.X% |
| 今日盈亏 | +$X,XXX (+X.X%) |
| 累计盈亏 | +$X,XXX (+X.X%) |

---

### 持仓明细

| 股票 | 股数 | 成本 | 现价 | 市值 | 盈亏 | 盈亏% | 权重 |
|------|------|------|------|------|------|-------|------|
| NVDA | 100 | $140.00 | $150.00 | $15,000 | +$1,000 | +7.1% | 12.5% |
| AAPL | 50 | $180.00 | $185.00 | $9,250 | +$250 | +2.8% | 7.7% |
| ... | | | | | | | |
| **合计** | | | | **$XX,XXX** | **+$X,XXX** | **+X.X%** | **XX%** |

---

### 盈利持仓 🟢

| 股票 | 盈亏 | 盈亏% |
|------|------|-------|
| NVDA | +$1,000 | +7.1% |

### 亏损持仓 🔴

| 股票 | 盈亏 | 盈亏% |
|------|------|-------|
| AMD | -$200 | -2.5% |

---

### 最近操作（30天）

| 日期 | 股票 | 操作 | 股数 | 价格 | 金额 |
|------|------|------|------|------|------|
| 2025-10-28 | NVDA | BUY | 50 | $145.50 | $7,275 |
| 2025-10-27 | AAPL | REDUCE | 20 | $182.00 | $3,640 |

---

### 风险指标

| 指标 | 当前 | 限制 | 状态 |
|------|------|------|------|
| 总仓位 | XX% | 80% | ✅ |
| 最大单只 | XX% | 15% | ✅ |
| 集中度 (Top 3) | XX% | - | - |
```

## 可选视图

### 按板块分组

```markdown
### 板块分布

| 板块 | 市值 | 权重 | 盈亏 |
|------|------|------|------|
| 科技 | $24,250 | 20.2% | +$1,250 |
| 消费 | $9,250 | 7.7% | +$250 |
```

### 按买入日期

```markdown
### 持仓时长

| 股票 | 买入日期 | 持有天数 | 盈亏 |
|------|----------|----------|------|
| NVDA | 2025-10-15 | 13 | +7.1% |
```

## 空仓状态

如果没有持仓：

```markdown
## 📊 持仓概览

**当前状态**: 空仓

| 项目 | 金额 |
|------|------|
| 现金 | $100,000 |
| 总权益 | $100,000 |
| 仓位 | 0% |

*尚无持仓记录。使用 `/record-operation` 记录交易。*
```

## 数据刷新

持仓数据来源：
- `storage/positions.json` - 持仓快照
- `storage/operations.jsonl` - 操作日志
- 实时价格 via `get_price()`

如需刷新持仓计算：
```
update_positions()
```

## 后续步骤

查看持仓后：
1. `/stock-analysis {SYMBOL}` - 分析特定持仓
2. `/position-sizing` - 规划加仓
3. `/record-operation` - 记录新操作
