# AI Trader Assist

> **真实宏观驱动的美股量化交易系统** — Objective Macro Data + 预防式风控 + 趋势跟踪

[![Python 3.12](https://img.shields.io/badge/Python-3.12-blue.svg)](https://www.python.org/)
[![PostgreSQL 18](https://img.shields.io/badge/PostgreSQL-18-336791.svg)](https://www.postgresql.org/)
[![6Y Return](https://img.shields.io/badge/6Y%20Return-+330%25-brightgreen.svg)](#回测验证)
[![Alpha](https://img.shields.io/badge/Alpha-+218%25-green.svg)](#回测验证)
[![Sharpe](https://img.shields.io/badge/Sharpe-1.25-blue.svg)](#回测验证)

**V8.2 成果 (2020-2026)**: 基于 **100% 真实历史数据** (非合成) 实现收益率 **+330%** (vs SPY +113%)，Alpha **+218%**。

---

## 核心亮点

- **V8.2 真实客观策略**: 彻底弃用模拟数据，完全基于 Yahoo Finance 真实宏观指标 (`HYG`, `^VIX`, `^TNX` 等)
- **预防式风控**: VIX 趋势预警 + 冷却期机制，成功规避 2020 疫情与 2022 熊市
- **6年穿越验证**: 真实资金曲线穿越牛熊，年化收益 **+27.3%**

---

## 目录

- [系统架构](#系统架构)
- [回测验证](#回测验证)
- [快速开始](#快速开始)
- [策略演进](#策略演进)
- [数据源说明](#数据源说明)
- [开发指南](#开发指南)

---

## 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│  V8.2 策略 = 客观宏观主题 + 预防式风控 + 趋势跟踪                  │
├─────────────────────────────────────────────────────────────────┤
│  🌍 客观宏观生成器 (Objective Macro Generator)                    │
│     基于真实市场定价 (权重总和 1.0):                              │
│     - 动量 (30%): 个股相对强度                                    │
│     - 风险偏好 (20%): HYG/TLT (高收益债/国债比率)                  │
│     - 恐慌指数 (15%): ^VIX (CBOE Volatility)                     │
│     - 经济前景 (15%): XLY/XLP (非必需/必需消费比)                  │
│     - 宏观环境 (20%): ^TNX (利率), UUP (美元), ^IRX (流动性)       │
├─────────────────────────────────────────────────────────────────┤
│  🛡️ 预防式风控 (4 级状态机)                                       │
│     Normal → Watch → Caution → Danger                           │
│     - 提前预警: VIX 趋势上升时开始减仓                             │
│     - 延迟恢复: 冷却期机制 (danger=10天)                          │
│     - 渐进减仓: 优先减亏损最大的持仓                               │
├─────────────────────────────────────────────────────────────────┤
│  📈 趋势跟踪执行                                                  │
│     - SPY > SMA50 才开仓                                         │
│     - 动量选股 + 15% 跟踪止损                                     │
│     - 科技龙头聚焦 (NVDA/META/GOOGL/AMZN/MSFT...)                │
└─────────────────────────────────────────────────────────────────┘
```

---

## 回测验证

### V8.2 真实数据回测 (2020-01-02 ~ 2026-01-16)

> **注意**: 以下结果完全基于真实历史数据，无未来函数，无合成数据。

| 指标 | **V8.2 (真实)** | SPY 基准 | 差异 |
| :--- | :--- | :--- | :--- |
| **总收益率** | **+330.98%** | +112.90% | +218pp |
| **年化收益** | **+27.34%** | +13.1% | +14.2pp |
| **最大回撤** | **24.49%** | 33.7% | 更优 |
| **夏普比率** | **1.25** | 0.72 | +0.53 |
| **胜率** | **57.8%** | - | - |
| **盈亏比** | **3.06** | - | - |

### 关键时间节点表现

| 日期 | 资金 | 事件 | 策略行为 |
|------|------|------|----------|
| 2020-03 | - | **疫情崩盘** | 2月27日提前减仓 (Watch)，规避主跌浪 |
| 2020-08 | $145k | **大放水** | HYG/TLT 指示 Risk-On，满仓科技股 |
| 2022-01 | - | **加息周期** | VIX 长期高位，处于 Caution/Danger 模式 |
| 2023-01 | $150k | **AI牛市起点** | 动量因子激活，重仓 NVDA/META |
| 2026-01 | **$431k** | **终点** | 6年翻4.3倍 |

### 最大盈利交易

| 日期 | 股票 | 盈亏 | 收益率 | 原因 |
|------|------|------|--------|------|
| 2024-04-25 | META | **+$73,349** | +287% | 跟踪止损 |
| 2025-12-15 | AVGO | +$37,991 | +67% | 跟踪止损 |
| 2025-11-20 | NVDA | +$32,805 | +58% | 预防性减仓 |
| 2024-12-31 | TSLA | +$23,984 | +40% | 跟踪止损 |
| 2023-09-21 | NVDA | +$18,349 | +53% | 跟踪止损 |

---

## 快速开始

### 1. 环境准备

```bash
git clone https://github.com/your-repo/trader.git
cd trader

python3 -m venv .venv
source .venv/bin/activate

pip install -r requirements.txt
```

### 2. 配置数据库

```bash
cp .env.example .env
# 编辑 .env 填入 PostgreSQL 配置 (PG_HOST, PG_PASSWORD等)
```

### 3. 数据准备 (只需一次)

```bash
# 1. 补充 2018-2020 价格数据
PYTHONPATH=. python scripts/supplement_daily_prices.py

# 2. 导入真实宏观数据 (^VIX, HYG, ^TNX...)
PYTHONPATH=. python scripts/import_objective_macro.py
```

### 4. 运行回测

```bash
# 运行 V8.2 真实策略回测
PYTHONPATH=. python scripts/run_backtest_v8_1.py
```

---

## 策略演进

| 版本 | 策略名称 | 数据源 | 6Y收益 | 说明 |
|------|----------|--------|--------|------|
| V5c | 预防式风控 | 纯价格 | +115% | 基础版本 |
| V8.1 | 事前主题 | 模拟/合成 | +268% | 验证逻辑，数据有偏差 |
| **V8.2** | **客观宏观** | **真实历史** | **+330%** | **最终定稿，可实盘** |

---

## 数据源说明

**所有数据均来自 Yahoo Finance (免费公开)**，无昂贵的 Alternative Data 依赖。

| 代码 | 名称 | 作用 | 逻辑 |
| :--- | :--- | :--- | :--- |
| **^VIX** | CBOE Volatility Index | **风控核心** | >20 警戒，>28 危险 |
| **HYG** | High Yield Bond ETF | **风险偏好** | HYG vs TLT 上涨 = 资金追逐风险 |
| **TLT** | 20+ Year Treasury Bond | **避险情绪** | 分母资产 |
| **^TNX** | 10-Year Treasury Yield | **宏观环境** | 利率急升利空科技股 |
| **XLY** | Consumer Discretionary | **经济前景** | XLY vs XLP 上涨 = 消费信心强 |
| **UUP** | US Dollar Index Bullish | **汇率影响** | 美元过强利空跨国巨头 |

---

## 免责声明

⚠️ **本项目仅用于研究与教学，不连接任何券商系统，不构成投资建议。**

- 回测结果不代表未来收益
- 实盘交易需考虑滑点、手续费、流动性等因素
- 投资有风险，入市需谨慎

---

*Built with Python. Powered by Real Data. Guided by Discipline.*
